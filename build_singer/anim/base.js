modulex.add("anim/base",["dom","util","promise"],function(e,n,t){var i,u,a,o=e("dom"),r=e("util"),s=e("promise");i=function(e){function n(e,n,t){n=n||s;var u,o=i.data(e,a);return o||t||i.data(e,a,o={}),o&&(u=o[n],u||t||(u=o[n]=[])),u}var t,i=o,u=r,a=u.guid("ks-queue-"+u.now()+"-"),s=u.guid("ks-queue-"+u.now()+"-");return t={queueCollectionKey:a,queue:function(e,t,i){var u=n(e,t);return u.push(i),u},remove:function(e,i,a){var o,r=n(e,i,1);return r&&(o=u.indexOf(a,r),o>-1&&r.splice(o,1)),r&&!r.length&&t.clearQueue(e,i),r},clearQueues:function(e){i.removeData(e,a)},clearQueue:function(e,n){n=n||s;var t=i.data(e,a);t&&delete t[n],u.isEmptyObject(t)&&i.removeData(e,a)},dequeue:function(e,i){var u=n(e,i,1);return u&&(u.shift(),u.length||t.clearQueue(e,i)),u}},e=t}(),u=function(e){function n(e){var n=e.node,t=f.data(n,v);t||f.data(n,v,t={}),t[l.stamp(e)]=e}function t(e){var n=e.node,t=f.data(n,v);t&&(delete t[l.stamp(e)],l.isEmptyObject(t)&&f.removeData(n,v))}function u(e){var n=e.node,t=f.data(n,v);return t?!!t[l.stamp(e)]:0}function a(e){var n=e.node,t=f.data(n,p);t||f.data(n,p,t={}),t[l.stamp(e)]=e}function s(e){var n=e.node,t=f.data(n,p);t&&(delete t[l.stamp(e)],l.isEmptyObject(t)&&f.removeData(n,p))}function d(e){var n=e.node,t=f.data(n,p);return t?!!t[l.stamp(e)]:0}function c(e,n,t){var i=f.data(e,"resume"===t?p:v),u=l.merge(i);l.each(u,function(e){(void 0===n||e.config.queue===n)&&e[t]()})}var m=i,l=r,f=o,v=l.guid("ks-anim-unqueued-"+l.now()+"-"),p=l.guid("ks-anim-paused-"+l.now()+"-");return e={saveRunningAnim:n,removeRunningAnim:t,isAnimPaused:d,removePausedAnim:s,savePausedAnim:a,isAnimRunning:u,isElPaused:function(e){var n=f.data(e,p);return n&&!l.isEmptyObject(n)},isElRunning:function(e){var n=f.data(e,v);return n&&!l.isEmptyObject(n)},pauseOrResumeQueue:c,stopEl:function(e,n,t,i){t&&(void 0===i?m.clearQueues(e):i!==!1&&m.clearQueue(e,i));var u=f.data(e,v),a=l.merge(u);l.each(a,function(e){(void 0===i||e.config.queue===i)&&e.stop(n)})}}}(),a=function(e){function n(e){var n,t=e.config.complete;f.isEmptyObject(n=e._backupProps)||d.css(e.node,n),t&&t.call(e)}function t(e,n,i,u,a){var o,r=this;e.node?o=e:(f.isPlainObject(i)?o=f.clone(i):(o={complete:a},i&&(o.duration=i),u&&(o.easing=u)),o.node=e,o.to=n),o=f.merge(h,o),t.superclass.constructor.call(r),l.Defer(r),r.config=o,e=o.node,f.isPlainObject(e)||(e=d.get(o.node)),r.node=r.el=e,r._backupProps={},r._propsData={};var s={};n=o.to;for(var c in n)s[p(c)]=n[c];o.to=s}var a,d=o,c=u,m=i,l=s,f=r,v=d.NodeType,p=f.camelCase,g=f.noop,_={toggle:1,hide:1,show:1},h={duration:1,easing:"linear"};f.extend(t,l,{prepareFx:g,runInternal:function(){var e,n=this,t=n.config,i=n.node,u=n._backupProps,o=n._propsData,r=t.to,s=t.delay||0,m=t.duration;if(c.saveRunningAnim(n),f.each(r,function(e,n){f.isPlainObject(e)||(e={value:e}),o[n]=f.mix({delay:s,easing:t.easing,frame:t.frame,duration:m},e)}),i.nodeType===v.ELEMENT_NODE){if(r.width||r.height){var l=i.style;f.mix(u,{overflow:l.overflow,"overflow-x":l.overflowX,"overflow-y":l.overflowY}),l.overflow="hidden"}var p,g;if(f.each(o,function(t,o){if(e=t.value,_[e]){if(g===a&&(g="none"===d.css(i,"display")),"hide"===e&&g||"show"===e&&!g)return n.stop(!0),p=!1;u[o]=d.style(i,o),"toggle"===e&&(e=g?"show":"hide"),"hide"===e?(t.value=0,u.display="none"):(t.value=d.css(i,o),d.css(i,o,0),d.show(i))}return void 0}),p===!1)return}n.startTime=f.now(),f.isEmptyObject(o)?(n.__totalTime=1e3*m,n.__waitTimeout=setTimeout(function(){n.stop(!0)},n.__totalTime)):(n.prepareFx(),n.doStart())},isRunning:function(){return c.isAnimRunning(this)},isPaused:function(){return c.isAnimPaused(this)},pause:function(){var e=this;return e.isRunning()&&(e._runTime=f.now()-e.startTime,e.__totalTime-=e._runTime,c.removeRunningAnim(e),c.savePausedAnim(e),e.__waitTimeout?clearTimeout(e.__waitTimeout):e.doStop()),e},doStop:g,doStart:g,resume:function(){var e=this;return e.isPaused()&&(e.startTime=f.now()-e._runTime,c.removePausedAnim(e),c.saveRunningAnim(e),e.__waitTimeout?e.__waitTimeout=setTimeout(function(){e.stop(!0)},e.__totalTime):(e.beforeResume(),e.doStart())),e},beforeResume:g,run:function(){var e,n=this,t=n.config.queue;return t===!1?n.runInternal():(e=m.queue(n.node,t,n),1===e.length&&n.runInternal()),n},stop:function(e){var t,i=this,u=i.node,a=i.config.queue;if(i.isResolved()||i.isRejected())return i;if(i.__waitTimeout&&(clearTimeout(i.__waitTimeout),i.__waitTimeout=0),!i.isRunning()&&!i.isPaused())return a!==!1&&m.remove(u,a,i),i;i.doStop(e),c.removeRunningAnim(i),c.removePausedAnim(i);var o=i.defer;return e?(n(i),o.resolve([i])):o.reject([i]),a!==!1&&(t=m.dequeue(u,a),t&&t[0]&&t[0].runInternal()),i}});var w=t.Statics={isRunning:c.isElRunning,isPaused:c.isElPaused,stop:c.stopEl,Q:m};return f.each(["pause","resume"],function(e){w[e]=function(n,t){return null===t||"string"==typeof t||t===!1?c.pauseOrResumeQueue(n,t,e):c.pauseOrResumeQueue(n,void 0,e)}}),e=t}(),t.exports=a});