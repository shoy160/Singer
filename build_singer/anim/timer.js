modulex.add("anim/timer",["util","dom","feature","anim/base"],function(t,r,e){var n,a,o,s,i,u,c,l=t("util"),f=t("dom"),p=t("feature"),d=t("anim/base");n=function(t){function r(t){return t}function e(t,r,e,n){function a(t){return(3*c*t+2*p)*t+d}function o(t){return((c*t+p)*t+d)*t}function s(t){return((m*t+h)*t+v)*t}function i(t){for(var r,e,n=t,s=0;8>s;s++){if(e=o(n)-t,f(e)<l)return n;if(r=a(n),f(r)<l)break;n-=e/r}var i=1,u=0;for(n=t;i>u;){if(e=o(n)-t,f(e)<l)return n;e>0?i=n:u=n,n=(i+u)/2}return n}function u(t){return s(i(t))}var c=3*t-3*e+1,p=3*e-6*t,d=3*t,m=3*r-3*n+1,h=3*n-6*r,v=3*r;return u}var n=Math.PI,a=Math.pow,o=Math.sin,s=parseFloat,i=/^cubic-bezier\(([^,]+),([^,]+),([^,]+),([^,]+)\)$/i,u=1.70158,c={swing:function(t){return.5-Math.cos(t*n)/2},easeNone:r,linear:r,easeIn:function(t){return t*t},ease:e(.25,.1,.25,1),"ease-in":e(.42,0,1,1),"ease-out":e(0,0,.58,1),"ease-in-out":e(.42,0,.58,1),"ease-out-in":e(0,.42,1,.58),toFn:function(t){var n;return(n=t.match(i))?e(s(n[1]),s(n[2]),s(n[3]),s(n[4])):c[t]||r},easeOut:function(t){return(2-t)*t},easeBoth:function(t){return(t*=2)<1?.5*t*t:.5*(1- --t*(t-2))},easeInStrong:function(t){return t*t*t*t},easeOutStrong:function(t){return 1- --t*t*t*t},easeBothStrong:function(t){return(t*=2)<1?.5*t*t*t*t:.5*(2-(t-=2)*t*t*t)},elasticIn:function(t){var r=.3,e=r/4;return 0===t||1===t?t:0-a(2,10*(t-=1))*o(2*(t-e)*n/r)},elasticOut:function(t){var r=.3,e=r/4;return 0===t||1===t?t:a(2,-10*t)*o(2*(t-e)*n/r)+1},elasticBoth:function(t){var r=.45,e=r/4;return 0===t||2===(t*=2)?t:1>t?-.5*a(2,10*(t-=1))*o(2*(t-e)*n/r):a(2,-10*(t-=1))*o(2*(t-e)*n/r)*.5+1},backIn:function(t){return 1===t&&(t-=.001),t*t*((u+1)*t-u)},backOut:function(t){return(t-=1)*t*((u+1)*t+u)+1},backBoth:function(t){var r=u,e=(r*=1.525)+1;return(t*=2)<1?.5*t*t*(e*t-r):.5*((t-=2)*t*(e*t+r)+2)},bounceIn:function(t){return 1-c.bounceOut(1-t)},bounceOut:function(t){var r,e=7.5625;return r=1/2.75>t?e*t*t:2/2.75>t?e*(t-=1.5/2.75)*t+.75:2.5/2.75>t?e*(t-=2.25/2.75)*t+.9375:e*(t-=2.625/2.75)*t+.984375},bounceBoth:function(t){return.5>t?.5*c.bounceIn(2*t):.5*c.bounceOut(2*t-1)+.5}},l=1e-6,f=Math.abs;return t=c}(),a=function(t){var r,e,n=15;r=function(t){return setTimeout(t,n)},e=function(t){clearTimeout(t)};var a={head:null,tail:null},o=t={runnings:a,timer:null,start:function(t){t._ksNext=t._ksPrev=null,a.head?(t._ksPrev=a.tail,a.tail._ksNext=t,a.tail=t):a.head=a.tail=t,o.startTimer()},stop:function(t){this.notRun(t)},notRun:function(t){t._ksPrev?(a.tail===t&&(a.tail=t._ksPrev),t._ksPrev._ksNext=t._ksNext,t._ksNext&&(t._ksNext._ksPrev=t._ksPrev)):(a.head=t._ksNext,a.tail===t&&(a.tail=a.head),a.head&&(a.head._ksPrev=null)),t._ksNext=t._ksPrev=null,a.head||o.stopTimer()},pause:function(t){this.notRun(t)},resume:function(t){this.start(t)},startTimer:function(){var t=this;t.timer||(t.timer=r(function e(){t.timer=r(e),t.runFrames()&&t.stopTimer()}))},stopTimer:function(){var t=this,r=t.timer;r&&(e(r),t.timer=0)},runFrames:function(){for(var t=a.head;t;){var r=t._ksNext;t.frame(),t=r}return!a.head}};return t}(),o=function(t){function r(t,r){s.mix(t,r),t.pos=0,t.unit=t.unit||""}function e(t){r(this,t)}function n(t,r){var e;return t.style&&null!=t.style[r]||null==(e=i.attr(t,r,o,1))?null:e}function a(t,r){var e,n=s.now(),a=t.startTime,o=r.delay,i=r.duration;return e=n-a-o,0>=e?0:e>=i?1:r.easing(e/i)}var o,s=l,i=f,u=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i;return e.prototype={isCustomFx:0,constructor:e,load:function(t){r(this,t)},frame:function(t){if(1!==this.pos){var r=this,e=r.anim,n=r.prop,s=e.node,u=r.from,c=r.propData,l=r.to;if(t===o&&(t=a(e,c)),r.pos=t,u!==l&&0!==t){var f=r.interpolate(u,l,r.pos);r.val=f,c.frame?c.frame.call(r,e,r):r.isCustomFx||(f===o?(r.pos=1,f=l,console.warn("anim: "+n+"anim update directly ! : "+f+" : "+u+" : "+l)):f+=r.unit,r.val=f,"attr"===r.type?i.attr(s,n,f,1):i.css(s,n,f))}}},interpolate:function(t,r,e){return"number"==typeof t&&"number"==typeof r?Math.round(1e5*(t+(r-t)*e))/1e5:null},cur:function(){var t,r,e,a=this,s=a.prop,c=a.anim.node;if(a.isCustomFx)return c[s]||0;if((t=a.type)||(t=a.type=null!==(e=n(c,s))?"attr":"css"),"attr"===t)e=void 0===e?i.attr(c,s,o,1):e;else{e=i.style(c,s);var l=e.match(u);if(l){var f=l[3];f&&"px"!==f&&(e=i.css(c,s))}}return isNaN(r=parseFloat(e))?e&&"auto"!==e?e:0:r}},e.Factories={},e.FxTypes={},e.getFx=function(t){var r,n,a=e;return(r=t.fxType)?a=e.FxTypes[r]:!t.isCustomFx&&(n=e.Factories[t.prop])&&(a=n),new a(t)},t=e}(),s=function(t){function r(t){t+="";var r;if(r=t.match(c))return[parseInt(r[1],10),parseInt(r[2],10),parseInt(r[3],10)];if(r=t.match(f))return[parseInt(r[1],10),parseInt(r[2],10),parseInt(r[3],10),parseInt(r[4],10)];if(r=t.match(p)){for(var e=1;e<r.length;e++)r[e].length<2&&(r[e]+=r[e]);return[parseInt(r[1],s),parseInt(r[2],s),parseInt(r[3],s)]}return u[t=t.toLowerCase()]?u[t]:(console.warn("anim: only allow rgb or hex color string : "+t),[255,255,255])}function e(){e.superclass.constructor.apply(this,arguments)}var n=l,a=o,s=16,i=Math.floor,u={black:[0,0,0],silver:[192,192,192],gray:[128,128,128],white:[255,255,255],maroon:[128,0,0],red:[255,0,0],purple:[128,0,128],fuchsia:[255,0,255],green:[0,128,0],lime:[0,255,0],olive:[128,128,0],yellow:[255,255,0],navy:[0,0,128],blue:[0,0,255],teal:[0,128,128],aqua:[0,255,255]},c=/^rgb\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\)$/i,f=/^rgba\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+),\s*([0-9]+)\)$/i,p=/^#?([0-9A-F]{1,2})([0-9A-F]{1,2})([0-9A-F]{1,2})$/i,d=["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","color","outlineColor"];return n.extend(e,a,{load:function(){var t=this;e.superclass.load.apply(t,arguments),t.from&&(t.from=r(t.from)),t.to&&(t.to=r(t.to))},interpolate:function(t,r,n){var a=e.superclass.interpolate;return 3===t.length&&3===r.length?"rgb("+[i(a(t[0],r[0],n)),i(a(t[1],r[1],n)),i(a(t[2],r[2],n))].join(", ")+")":4===t.length||4===r.length?"rgba("+[i(a(t[0],r[0],n)),i(a(t[1],r[1],n)),i(a(t[2],r[2],n)),i(a(t[3]||1,r[3]||1,n))].join(", ")+")":(console.warn("anim: unknown color value : "+t),void 0)}}),n.each(d,function(t){a.Factories[t]=e}),a.FxTypes.color=e,t=e}(),i=function(t){function r(t){return t=t.split(/,/),t=u.map(t,function(t){return a(t)})}function e(t){t=r(t);var e,n,o,s=t[0],i=t[1],u=t[2],c=t[3];return s*c-i*u?(e=Math.sqrt(s*s+i*i),o=(s*u+i*c)/(s*c-u*i),n=(s*c-i*u)/e,i*u>s*c&&(o=-o,e=-e)):e=n=o=0,{translateX:a(t[4]),translateY:a(t[5]),rotate:a(180*Math.atan2(i,s)/Math.PI),skewX:a(180*Math.atan(o)/Math.PI),skewY:0,scaleX:a(e),scaleY:a(n)}}function n(){return{translateX:0,translateY:0,rotate:0,skewX:0,skewY:0,scaleX:1,scaleY:1}}function a(t){return Math.round(1e5*parseFloat(t))/1e5}function s(t){t=t.split(")");for(var r,o,s,i=u.trim,c=-1,l=t.length-1,f=n();++c<l;)switch(r=t[c].split("("),o=i(r[0]),s=r[1],o){case"translateX":case"translateY":case"scaleX":case"scaleY":f[o]=a(s);break;case"rotate":case"skewX":case"skewY":var p=a(s);u.endsWith(s,"deg")||(p=180*p/Math.PI),f[o]=p;break;case"translate":case"translate3d":s=s.split(","),f.translateX=a(s[0]),f.translateY=a(s[1]||0);break;case"scale":s=s.split(","),f.scaleX=a(s[0]),f.scaleY=a(s[1]||s[0]);break;case"matrix":return e(s)}return f}function i(){i.superclass.constructor.apply(this,arguments)}var u=l,c=p,d=f,m=o,h=c.isTransform3dSupported()?"translate3d({translateX}px,{translateY}px,0)":"translate({translateX}px,{translateY}px)";return u.extend(i,m,{load:function(){var t=this;i.superclass.load.apply(t,arguments),t.from=d.style(t.anim.node,"transform")||t.from,t.from=t.from&&"none"!==t.from?s(t.from):n(),t.to=t.to?s(t.to):n()},interpolate:function(t,r,e){var n=i.superclass.interpolate,a={};return a.translateX=n(t.translateX,r.translateX,e),a.translateY=n(t.translateY,r.translateY,e),a.rotate=n(t.rotate,r.rotate,e),a.skewX=n(t.skewX,r.skewX,e),a.skewY=n(t.skewY,r.skewY,e),a.scaleX=n(t.scaleX,r.scaleX,e),a.scaleY=n(t.scaleY,r.scaleY,e),u.substitute(h+" rotate({rotate}deg) skewX({skewX}deg) skewY({skewY}deg) scale({scaleX},{scaleY})",a)}}),m.Factories.transform=i,t=i}(),u=function(t){return t={background:["backgroundColor"],border:["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor"],borderColor:["borderBottomColor","borderLeftColor","borderRightColor","borderTopColor"],borderBottom:["borderBottomWidth","borderBottomColor"],borderLeft:["borderLeftWidth","borderLeftColor"],borderTop:["borderTopWidth","borderTopColor"],borderRight:["borderRightWidth","borderRightColor"],font:["fontSize","fontWeight"],margin:["marginBottom","marginLeft","marginRight","marginTop"],padding:["paddingBottom","paddingLeft","paddingRight","paddingTop"]}}(),c=function(t){function r(t,e,n,a,o){var s=this;return s instanceof r?(r.superclass.constructor.apply(s,arguments),void 0):new r(t,e,n,a,o)}var e=f,s=l,i=d,c=n,p=a,m=o,h=u,v=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i;return s.extend(r,i,{prepareFx:function(){var t=this,r=t.node,n=t._propsData;s.each(n,function(t){t.duration*=1e3,t.delay*=1e3,"string"==typeof t.easing&&(t.easing=c.toFn(t.easing))}),s.each(h,function(t,a){var o,i,u=n[a];u&&(i=u.value,o={},s.each(t,function(t){o[t]=e.css(r,t)}),e.css(r,a,i),s.each(o,function(t,a){a in n||(n[a]=s.merge(u,{value:e.css(r,a)})),e.css(r,a,t)}),delete n[a])});var a,o,i,u,l,f,p,d,b,g=0;s.isPlainObject(r)&&(g=1);for(a in n){if(o=n[a],i=o.value,f={isCustomFx:g,prop:a,anim:t,fxType:o.fxType,type:o.type,propData:o},p=m.getFx(f),u=i,l=p.cur(),i+="",d="",b=i.match(v)){if(u=parseFloat(b[2]),d=b[3],d&&"px"!==d&&l){var k=0,x=u;do++x,e.css(r,a,x+d),k=p.cur();while(0===k);l=x/k*l,e.css(r,a,l+d)}b[1]&&(u=("-="===b[1]?-1:1)*u+l)}f.from=l,f.to=u,f.unit=d,p.load(f),o.fx=p}},frame:function(){var t,r,e,n=this,a=1,o=n._propsData;for(t in o){if(e=o[t],r=e.fx,r.frame(),n.isRejected()||n.isResolved())return;a&=1===r.pos}var i=s.now(),u=1e3*n.config.duration,c=Math.max(0,n.startTime+u-i),l=c/u||0,f=1-l;n.defer.notify([n,f,c]),a&&n.stop(a)},doStop:function(t){var r,e,n,a=this,o=a._propsData;if(p.stop(a),t)for(r in o)n=o[r],e=n.fx,e&&e.frame(1)},doStart:function(){p.start(this)}}),r.Easing=c,r.Fx=m,r.version="1.0.2",r._name_="TimerAnim",s.mix(r,i.Statics),t=r}(),e.exports=c});